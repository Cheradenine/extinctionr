{% extends "base.html" %}
{% block title %}:: {{object.name}} Circle{% endblock %}
{% block content %}
<div class="row pt-5" style="background-color: {{object.bgcolor}}">
	<div class="col-text">
		<h1 class="text-center">{{object.name}}{% for p in object.parents %} :: <a href="{{p.get_absolute_url}}">{{p.name}}</a>{% endfor %}{% if not object.parent %} <a href="{% url 'circles:outer' %}">&uarr;</a>{% endif %}</h1>
		{% if can_see_members %}<h5 class="text-center">{{object.get_all_members|length}} members</h5>{% endif %}
		{% if 'circles.change_circle' in perms %}
		<h4 class="text-center"><a href="/admin/circles/circle/{{object.id}}/change/">edit</a></h4>
		{% endif %}
		{% load info %}
		<div id="purpose" class="small">{{object.purpose|markdownify}}</div>
		{% if can_see_members %}
		<div id="leads">
			<h4 class="text-center">leads</h4>
			<ul class="pl-4 list-unstyled list-horizontal">
			{% for contact in object.leads.all %}
			<li><a href="{% url 'circles:person' contact_id=contact.id %}">{{contact.first_name}} {{contact.last_name}}</a> &mdash;  <a href="mailto:{{contact.email}}">{{contact.email}}</a></li>
			{% endfor %}
			</ul>
		</div>
		<div id="members">
			<h4 class="text-center">members</h4>
		{% if is_lead %}
			<form action="{% url 'circles:add-member' pk=object.id %}" class="container" method="post">
			{% csrf_token %}
			<div class="form-group row">
				<label for="signup_email" class="d-none col-2 offset-lg-3 offset-sm-1">Email:</label>
				<div class="col-10 offset-1 offset-lg-3 col-lg-6">
					<input type="email" name="email" id="signup_email" class="form-control" required placeholder="Email Address">
				</div>
			</div>
			<div class="form-group row">
				<label for="signup_name" class="d-none col-2 offset-lg-3 offset-sm-1">Name:</label>
				<div class="col-10 offset-1 offset-lg-3 col-lg-6">
					<input type="text" name="name" id="signup_name" class="form-control" required placeholder="Your Name">
				</div>
			</div>
			<div class="form-group row mt-4 pt-2">
				<div class="col-10 offset-1 offset-lg-3 col-lg-6">
					<input class="btn btn-block btn-fucxed btn-lg btn-outline-dark btn-success text-uppercase" type="submit" value="add member">
				</div>
			</div>
		</form>
		{% endif %}
			{% if members %}
			<table class="pl-4 table table-sm table-responsive-sm table-responsive-lg table-striped table-hover table-light">
			<thead class="thead-dark small">
				<tr class="text-center">
				<th scope="col">Name</th>
				<th scope="col">Email</th>
				<th scope="col">Phone</th>
				</tr>
			</thead>
			<tbody class="small">
			{% for contact in members %}
			<tr>
				<th scope="row" class="px-3"><a href="{% url 'circles:person' contact_id=contact.id %}">{{contact.first_name}} {{contact.last_name}}</a></td>
				<td class="text-center"><a href="mailto:{{contact.email}}">{{contact.email}}</a></td>
				<td>{% if contact.phone %}{{contact.phone}}{% endif %}</td>
			</tr>
			{% endfor %}
			</tbody>
			</table>
			{% endif %}
		</div>
		{% if members %}<a class="btn btn-info btn-fucxed" href="mailto:{{object.get_member_emails}}">email all</a>{% endif %}
		{% endif %}
		<hr>
	</div>
</div>
<div class="row">
	{% for subgroup in object.circle_set.all %}
	<div class="col p-2 pt-3 border" style="background-color: {{subgroup.bgcolor}}">
		<h3 class="text-center"><a href="{% url 'circles:detail' pk=subgroup.id %}">{{subgroup.name}}</a></h3>
		{% if can_see_members %}
		<h5 class="text-center">{{subgroup.get_all_members|length}} members</h5>
		<ul class="list-unstyled small">
		{% for contact in subgroup.leads.all %}
		<li><a href="mailto:{{contact.email}}">{{contact.first_name}} {{contact.last_name}}</a></li>
		{% endfor %}
		</ul>
		{% endif %}
	</div>
	{% endfor %}
</div>
{% endblock %}
